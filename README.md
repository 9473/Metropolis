# Metropolis
Metropolis algorithm of 2D lattice Ising Model by using MATLAB  
这是我先前做过的课程小论文，我不打算把物理原理一步到位详细讲完，目的是为了自己回顾的时候能够一下子抓住重点，以及代码的实现细节
## Ising Model
作为更局限的磁性模型，Ising Model的一个物理图像特点可能就在于此了，每个位点的自旋只能安排为 上 or 下: $S = \pm 1/2$，自旋只能取两个值意味着我们可以最简单化将自旋取为 $\pm 1$
一个位形Configuration由所有格点上的自旋状态组成。2D lattice Ising Model哈密顿量写成：  
$$\hat{H} = -\sum_i J\sigma_i \sigma_j$$
其中耦合系数是独立的，我们也可以最简单化处理设为 $J=1$ . 注意到 $J>0$ 意味着能量最低的状态格点总是倾向于平行排序，表现为铁磁性（如果对这里有疑问，建议回顾Heisenberg Model）。既然基态是完全极化铁磁性的，我们选择从一种所有格点都向上指的状态作为初始状态  
对于二维伊辛模型用蒙特卡罗处理的一般思路是  
1. 给出一个初始位形(x_11,x_12,x_13...x_ij,...x_NN)
2. 随机抽取一个点 x_ij 翻转方向
3. 该格点翻转方向会造成的能量变化  $$\Delta E = 2\times \sigma_{x_{ij}} \times ( \sigma_{x_{i+1,j}}+\sigma_{x_{i-1,j}}+\sigma_{x_{i,j+1}}+\sigma_{x_{i,j-1}} )$$  虽然从物理的角度 $\sigma_{ij}$ 表示比 $\sigma_{x_{i,j}}$ 更简单，但是从代码的角度，我们更容易理解后者：建立位点 `site(i,j)` 然后作为自旋数组的索引，`spin(site(i,j))`，这种思想还是比较常见的；当然，你仍然还是可以直接建立二维数组 `spin( , )`直接容纳 `i`,`j`.
4. 如果 $\Delta E<0$ ，说明翻转后能量降低，可以直接接受；如果 $\Delta E > 0$，要概率接受：生成一个 [0,1] 区间的随机数并与 $e^{-\beta \Delta E}$ 比较，如果这个概率比随机数更大，就接受翻转
5. 储存所有接受的位形，以计算热力学量的平均值。  
在这个具体的模型里面，有一些细节可以考虑：
- 为了节约计算，实际上没必要打算每翻转一个自旋就计算一次能量差。能量差可能的取值只有5种： $$\Delta E = 8J,4J,0,-4J,-8J$$ （这里如果搞不明白，就自己画图想一下，主要取决于你要翻转的这个自旋的邻居的情况）
- 由于相继的两个状态只相差一个自旋反转，因此它们的物理性质有很强的关联，并不需要每一次执行翻转之后都储存接受位形，究竟隔了多少位形才贡献计算，这个于温度和守恒定律有关（这一点我也没有搞得很明白）
- 给定的初始位形没有任何要求，可以是任意的，可以是本征态，为了节约计算，我们往往会直接或间接地选择一个靠近ground state的位形
## algorithm
初始化：  
`X=sign(rand(L,L))` 初始位形。MATLAB里符号函数`sign()`的作用是`sign(<0)=-1,sign(>0)=+1,sign(=0)=0 `，`rand(L,L)`生成了一个 $L\times L$ 大小的随机矩阵，并借sign函数给每个矩阵元赋值 $\pm 1$  
  
选择一个随机点：  
`index = unidrnd(L,1,2)` 随机取一个格点，行列储存在 `index[1,2]`, `unidrnd(N,m,n)`表示m和n分别指定生成的矩阵R的行数和列数，N表示产生从1到N的离散均匀随机整数  
`rem(x,y)`表示返回x除以y的余数  
index[1,2] 表示的是网格中选择的位点(x,y)，x=index(1),y=index(2). 所以这个1，2表示的是二维数组index的指标（而不是具体的值，千万别混淆）。返回御书这步很巧妙地包含了周期性边界条件。到这一步我们把这个随机位点的上下左右的坐标也搞定了，注意到cen,right,left,up,down是函数X()对坐标的映射，在这里很明显，就是坐标的自旋的值  
  
计算翻转格点后能量变化  
用 $\sigma_i'$ 表示翻转后的自旋，$\sigma_i$ 表示翻转之前的自旋，有 $\sigma_i'=-\sigma_i$，而 $E=-\sum_i \sigma_i\sigma_j$ 就有:  
$$\Delta E_i = -\sigma_i'\times \sigma(\text{up+down+right+left})-(-1)\sigma_i \times \sigma(\text{up+down+right+left}) = 2\sigma_i\times \sigma(\text{up+down+right+left})$$  
接受概率为 $p_i=e^{-\beta \Delta E_i}$  
判断是否接受翻格点 `if rand<p_i=exp(-deE*\beta_mc(jj)` $\beta(jj)$ 表示特定温度。  
经过足够长时间后，假设系统达到了平衡，这时可以根据位形计算对应的能量。  



计算一种特定分布时的平均能量   

